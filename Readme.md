### 테라폼을 사용한 웹 애플리케이션 인프라스트럭처 프로비저닝

> - `1단계` : 먼 아마존 웹서비스 계정을 준비하고, API키를 설정
> - `2단계 STEP 1` : 인프라스트럭쳐를 정의하는 HCL 언어로 필요한 리소스를 선언
> - `2단계 STEP 2` : 선언된 리소스들이 생성가능한지 계획(Plan)을 확인
> - `2단계 STEP 3` : 선언된 리소스들을 아마존 웹 서비스에 적용(Apply)
> - `3단계` : 웹 애플리케이션 배포

### 프로비저닝 (Provisioning)

> 어떤 프로세스나 서비스를 실행하기 위한 준비 단계를 프로비저닝이라고 합니다.
> 프로비저닝에는 크게 네트워크나 컴퓨팅 자원을 준비하는 작업과 준비된 컴퓨팅 자원에 사이트 패키지나 애플리케이션 의존성을 준비하는 단계로 나누어집니다. 명확한 경계는 불분명하지만 테라폼은 전자를 주로 다루는 도구입니다.

### 프로바이더 (Provider)

> 테라폼과 외부 서비스를 연결해주는 기능을 하는 모듈입니다. 예를 들어 테라폼으로 AWS 서비스의 컴퓨팅 자원을 생성하기 위해서는 aws 프로바이더를 먼저 셋업해야 합니다. 프로바이더는 AWS, Google Cloud Platform, Microsoft Azure와 같은 범용 클라우드 서비스를 비롯해 Github, Datadog, DNSimple과 같은 특정 기능을 제공하는 서비스, MySQL, RabbitMQ, Docker와 같은 로컬 서비스 등을 지원합니다.

### 리소스 (Resource)

> 리소스란 특정 프로바이더가 제공해주는 조작 가능한 대상의 최소 단위입니다. 예를 들어 AWS 프로바이더는 aws_instance 리소스 타입을 제공하고, 이 리소스 타입을 사용해 Amazon EC2의 가상 머신 리소스를 선언하고 조작하는 것이 가능합니다. EC2 인스턴스, 시큐리티 그룹, 키 페어 모두 aws 프로바이더가 제공해주는 리소스 타입입니다.

### HCL (Hashicorp Configuration Language)

> HCL은 테라폼에서 사용하는 설정 언어입니다. 테라폼에서 모든 설정과 리로스 선언은 HCL을 사용해 이루어집니다. 테라폼에서 HCL 파일의 확장자는 `.tf`를 사용합니다.

### 계획 (Plan)

> 테라폼 프로젝트 디렉터리 아래의 모든 `.tf`파일의 내용은 실제로 적용 가능한지 확인하는 작업을 계획이라고 합니다. 테라폼은 이를 `terraform plan` 명령어로 제공하며 이 명령어를 실행하면 어떤 리로스가 생성되고 수정되고 삭제될지 계획을 보여줍니다.

### 적용 (Apply)

> 테라폼 프로젝트 디렉터리 아래의 모든 `.tf` 파일의 내용대로 리소스를 생성, 수정, 삭제하는 일을 적용이라고 합니다. 테라폼은 이를 `terraform apply`명령어로 제공합니다. 이 명령어를 실행하기 전에
> 변경 예정 사항은 plan 명령어를 사용해 확인할 수 있습니다. 적용하기 전에도 플랜의 결과를 보여줍니다.

plan의 작동 방식을 이해하기 위해서는 테라폼의 동작 방식을 이해할 필요가 있습니다. 테라폼에서 리소스는 선언적으로 기술됩니다. 테라폼은 `.tf` 파일에 기술되어있는 모든 리소스를 읽어들이고 먼저 이 리소스들이 존재하는 상태를 가정합니다. 편의상 이를 이상적인 상태라고 부르겠습니다. 예를 들어 `aws_key_pair.web_admin`은 이상적인 상태에 존재하는 리소스입니다. 하지만 이 리소스는 실제로 생성된 적은 없기 때문에 프로바이더에 지정한 AWS 계정에는 존재하지 않습니다. 즉, 내 AWS 계정의 실제 상태에는 `aws_key_pair.web_admin`이 아직 존재하지 않습니다.

테라폼의 가장 중요한 역할은 실제 상태를 이상적인 상태와 동일하게 만드는 일입니다. 테라폼에서는 이 작업을 적용한다 `apply`라고 표현합니다. 테라폼 `plan`은 `apply` 하기 전에 이상적인 상태와 실제 상태를 비교해 둘을 동일하게 만들기 위해서 해야할 일을 찾아내는 작업입니다. 이 예제에서 `aws_key_pair.web_admin` 리소스는 이상적인 상태에만 존재하고 실제 상태에는 존재하지 않습니다. 따라서 테라폼이 실제 상태를 이상적인 상태와 동일하게 만들기 위해서는 실제 상태에 `aws_key_pair.web_admin` 리소스를 생성해야 합니다.

`terraform apply`를 실행하고 나면 프로젝트 상에 중요한 변화가 하나 생기는데 작업 디렉터리 아래 `terraform.tfstate` 파일이 하나 생성됩니다. 이 파일에는 실제 상태를 임시로 저장하는 동시에 테라폼에서 관리되는 리소스의 목록을 관리합니다.

### `endpoint check (EC2)`

```bash
terraform console
aws_instance.web.public_ip
aws_instance.ec2명.public_ip
```

### `endpoint check (RDS)`

```bash
terraform console
aws_db_instance.web_db.endpoint
aws_db_instance.rds명.endpoint
```

### `ec2에서 rds 서버 접속`

```bash
sudo yum install -y mysql
mysql -h [RDS 엔드포인트] -u admin -p
```

### 임시 비밀번호 설정

코드상에 config 정보를 노출시키지 않기 위해 TLS 통신으로 가져온다고 해도 `terraform.tfstate` 파일에 노출되므로 임시 비밀번호를 설정하고 `apply`후에 비밀번호 재설정할 것.

## Why ? 테라폼을 사용하는 이유

웹 콘솔을 사용해 리소스를 관리하는 것과는 많이 다릅니다. 프로젝트에서 테라폼을 사용해보면 매번 리소스 레퍼런스를 확인하고 웹 콘솔과 비교해보는 과정을 계속해서 반복해야 합니다. 어떤 면에서는 웹 콘솔보다 오히려 어렵고 귀찮습니다.

그럼에도 불구하고 테라폼을 사용하면 좋은 점들이 있습니다. 먼저 웹 콘솔을 사용해 리소스들을 관리하면서 점차 리소스가 많아지기 시작하면 더 이상 전체 리소스를 파악할 수 없는 시점이 옵니다. 업무용으로 사용하는 경우 명시적인 리소스와 비명시적인 리소스를 포함해 수백 수천개의 리소스를 다루는 일이 일반적입니다. 언제 왜 만들었는지 알 수 없는 리소스들이 점점 쌓여나가고 레거시로 남습니다. 테라폼을 사용하면 프로비저닝하고자 하는 상태를 코드로 명확히 기록해두기 때문에 웹 콘솔만 사용할 때보다 파악이 쉬워지고 세심한 관리가 가능해집니다.

또한 테라폼은 코드로서의 인프라스트럭쳐`(Infrastructure as Code)`를 지향하는 도구로서 코드를 작성할 때 누리던 생태계의 이점을 그대로 이용할 수 있습니다. 저장소에서 이력 추적을 할 수도 있고 깃허브(Github)에서 팀원들과 코드 리뷰를 진행할 수도 있습니다. 이 과정에서 누가 어떤 리소스를 왜 추가했는지 투명성은 자동적으로 얻어집니다. 좀 더 잘 활용한다면 CI를 사용해 코드 리뷰가 된 사항을 자동적으로 플랜 및 저굥하는 것도 가능합니다.

참고자료: [테라폼(Terraform) 기초 튜토리얼](https://www.44bits.io/ko/post/terraform_introduction_infrastrucute_as_code)

### DevOps란 무엇인가 ?

> DevOps는 Dev(개발)과 Ops(운영)이 합쳐진 용어입니다. DevOps의 기본 개념은 간단히 말하면 개발과 운영의 경계를 허물고 통합한다고 할 수 있습니다. 점차 기술 발전 속도가 빨라지면서 개발과 운영이 분리되어 생기는 병목을 없애고자 DevOps를 도입하는 기업들이 늘어나고 있습니다. 하지만 개발과 운영을 통합한다는 것은 실제로 생각보다 복잡합니다. 그래서 DevOps를 다양하게 정의할 수 있으며 혹자는 이를 단순히 환상이자 개념일 뿐이라고 생각합니다. 하지만 DevOps는 그렇지 않습니다.

### DevOps의 정의

> DevOps를 정의하는 다양한 표현이 있습니다. 그 중 아래 5가지 단어들을 이용하여 이야기 하는게 가장 쉽고 이해하기 쉬운 표현인 것 같습니다. DevOps는 아래 5가지 철학/방법을 지향하여 프로세스를 만들고 문화를 만들어나가는 철학입니다.

- `문화(Culture)`
- `자동화(Automation)`
- `측정(Measurement)`
- `공유(Sharing)`
- `축적(File up and Pile up)`

### DevOps가 필요한 이유

> DevOps가 필요한 이유는 바로 속도와 효율 때문입니다. 기술 발전이 급속도로 이루어지고 있는 시대에서 이를 뒷받침할 수 있는 개발 속도를 갖추는 것은 상당히 중요합니다. 여기서 말하는 개발 속도는 단순히 프로그래밍을 빠르게 하는 것을 의미하지 않습니다. Product 개발에서 발생하는 모든 과정(구상, 운영, 개발, 디자인, 출시 등등)의 속도 모두 중요합니다. 이 모든 일련의 과정이 빠른 속도와 효율적인 방식을 통해 이루어져야 남들보다 앞서갈 수 있습니다. 이런 관점에서 대부분의 기업에서는 DevOps를 필요로 합니다.

### DevOps 엔지니엉가 하는 일

올바른 DevOps 문화를 위해 서비스 혹은 S/W LifeCycle에서 반복적인 일들을 자동화하고, 팀간의 차이를 기술적으로 해소시킵니다.

- `문화(Culture)` - 사람, 서비스, S/W 라이프 싸이클
- `자동화(Automation)` - 프로그래밍, 자동화 툴, 네트워크 등
- `측정(Measurement)` - 테스트 및 데이터를 통한 추론
- `공유(Sharing)` - 어떤 문제를 최단 시간안에 해결하는 방법
- `축적(File up and Pile up)` - 재반복할 수 있는 이 문제에서 정확하게 회고하고 축적해 나가는 것

[DevOps 로드맵]("https://roadmap.sh/devops")
